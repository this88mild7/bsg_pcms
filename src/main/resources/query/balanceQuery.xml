<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="balanceQuery">
   
   <!-- INSERT -->
   <insert id="createSaleCompany" 
   	parameterType="com.bsg.pcms.balance.dto.BalanceDTOEx" 
   	useGeneratedKeys="true" 
   	keyProperty="balance_mgmtno">
		INSERT INTO BALANCE
			( 
				COMPANY_MGMTNO,
				USER_MGMTSEQ, 
				SALE_STR_DATE, 
				SALE_END_DATE, 
				SALE_COMMISSION, 
				CP_COMMISSION, 
				OWNER_PROFIT, 
				TOTAL_SALE_COUNT, 
				TOTAL_SALE_PRICE, 
				MOD_DT, 
				REG_DT )
		VALUES
			( 
				#{company_mgmtno}, 
				#{user_mgmtseq}, 
				#{sale_str_date}, 
				#{sale_end_date}, 
				#{sale_commission}, 
				#{cp_commission}, 
				#{owner_profit}, 
				#{total_sale_count}, 
				#{total_sale_price}, 
				NOW(), 
				NOW() 
			)
   </insert>

   <!-- SELECT -->
	<select id="list" resultType="com.bsg.pcms.balance.dto.BalanceDTOEx">
		SELECT BAL.*, COM.COMPANY_NAME FROM BALANCE BAL, COMPANY COM
		WHERE 1=1
		AND COM.COMPANY_MGMTNO = BAL.COMPANY_MGMTNO 
		AND BAL.DEL_YN = 'N'
		AND BAL.REG_DT
			BETWEEN TIMESTAMP(CONCAT( DATE_FORMAT(NOW(), '%Y'), DATE_FORMAT(NOW(), '%m'), '01'))  
			AND TIMESTAMP(DATE_FORMAT(LAST_DAY((NOW())), '%Y-%m-%d 23:59:59'))
		<!-- 등록순 -->
		<if test="printType == 1">
			ORDER BY BAL.BALANCE_MGMTNO 
		</if>
		<!-- 매출순 -->
		<if test="printType == 2">
			ORDER BY BAL.TOTAL_SALE_PRICE DESC
		</if>
		<!-- 수익순 -->
		<if test="printType == 3">
			ORDER BY BAL.OWNER_PROFIT DESC
		</if>
		<!-- 판매순 -->
		<if test="printType == 4">
			ORDER BY BAL.TOTAL_SALE_COUNT DESC
		</if>
	</select>
	
	
	<select id="searchByDate" resultType="com.bsg.pcms.balance.dto.BalanceDTOEx">
		SELECT BAL.*, COM.COMPANY_NAME FROM BALANCE BAL, COMPANY COM
		WHERE 1=1
		AND COM.COMPANY_MGMTNO = BAL.COMPANY_MGMTNO 
		AND BAL.DEL_YN = 'N'
		AND BAL.REG_DT 
			BETWEEN #{searchStrDate}  
			AND #{searchEndDate}
		<!-- 등록순 -->
		<if test="printType == 1">
			ORDER BY BAL.BALANCE_MGMTNO 
		</if>
		<!-- 매출순 -->
		<if test="printType == 2">
			ORDER BY BAL.TOTAL_SALE_PRICE DESC
		</if>
		<!-- 수익순 -->
		<if test="printType == 3">
			ORDER BY BAL.OWNER_PROFIT DESC
		</if>
		<!-- 판매순 -->
		<if test="printType == 4">
			ORDER BY BAL.TOTAL_SALE_COUNT DESC
		</if>
	</select>
	
	<select id="searchByWord" resultType="com.bsg.pcms.balance.dto.BalanceDTOEx">
		SELECT 
			BAL.*, 
			COM.COMPANY_NAME 
		FROM BALANCE BAL, COMPANY COM
		WHERE 1=1
		AND COM.COMPANY_MGMTNO = BAL.COMPANY_MGMTNO 
		AND BAL.DEL_YN = 'N'
		AND COM.COMPANY_NAME like '%${searchQuery}%'
		<!-- 등록순 -->
		<if test="printType == 1">
			ORDER BY BAL.BALANCE_MGMTNO 
		</if>
		<!-- 매출순 -->
		<if test="printType == 2">
			ORDER BY BAL.TOTAL_SALE_PRICE DESC
		</if>
		<!-- 수익순 -->
		<if test="printType == 3">
			ORDER BY BAL.OWNER_PROFIT DESC
		</if>
		<!-- 판매순 -->
		<if test="printType == 4">
			ORDER BY BAL.TOTAL_SALE_COUNT DESC
		</if>
	</select>
	
	<select id="detail" resultType="com.bsg.pcms.balance.dto.BalanceDTOEx">
		SELECT BAL.*, COM.COMPANY_NAME FROM BALANCE BAL, COMPANY COM
		WHERE 1=1
		AND COM.COMPANY_MGMTNO = BAL.COMPANY_MGMTNO 
		AND BAL.BALANCE_MGMTNO =  #{balance_mgmtno} 
		AND BAL.DEL_YN = 'N'
	</select>
   <!-- UPDATE -->

   <!-- DELETE -->
   
</mapper>
